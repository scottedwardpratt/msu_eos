\documentclass[12pt]{article}
\usepackage{subfiles}
\usepackage{graphicx}
\usepackage{relsize}
\usepackage[
        pdfencoding=auto,%
        pdfauthor={Scott Pratt},%
        pdfstartview=FitV,%
        colorlinks=true,%
        linkcolor=blue,%
        citecolor=blue, %
        urlcolor=blue,
        breaklinks=true]{hyperref}
%\usepackage[anythingbreaks,hyphenbreaks]{breakurl}
\usepackage[anythingbreaks,hyphenbreaks]{xurl}
%\usepackage{pdfsync}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{bm}
\numberwithin{equation}{section} 
\numberwithin{figure}{section} 
\usepackage[small,bf]{caption}
%\usepackage{fontspec}
%\usepackage{textcomp}
%\usepackage{color}
\usepackage{fancyhdr}
\setlength{\headheight}{16pt}
%\usepackage[headheight=110pt]{geometry}
\usepackage{bm}

\usepackage[most]{tcolorbox}
\tcbset{
frame code={}
center title,
left=0pt,
right=0pt,
top=0pt,
bottom=0pt,
colback=gray!25,
colframe=white,
width=\dimexpr\textwidth\relax,
enlarge left by=0mm,
boxsep=5pt,
arc=0pt,outer arc=0pt,
}
\newcounter{examplecounter}
\counterwithin{examplecounter}{section}
\setcounter{examplecounter}{0}
\newcommand{\example}[2]{\begin{tcolorbox}[breakable,enhanced]
\refstepcounter{examplecounter}{
\bf Example \arabic{section}.\arabic{examplecounter}:}~~{\bf #1}\\
{#2}
\end{tcolorbox}
}
\textwidth 7.0 in
\hoffset -0.8 in
%\newcommand{\exampleend}{
%\begin{samepage}
%\nopagebreak\noindent\rule{\textwidth}{1pt}
%\end{samepage}
%}


%\usepackage{silence}
%\WarningFilter{hyperref}{Token not allowed in a PDF String}

\newcommand\eqnumber{\addtocounter{equation}{1}\tag{\theequation}}

\newcommand{\solution}[1]{ }



\usepackage{comment}
\parskip 4pt
\parindent 0pt

%\newcommand{\bm}{\boldmath}
\boldmath

%

\begin{document}

\today\\

\centerline{\bf \large Fixed Charge Thermodynamics}
%\centerline{Oleh Savchuk and Scott Pratt}
%\centerline{Michigan State University}

\section{Basing relations on Free-Energy Density}

We need thermodynamic quantities in terms of density and temperature. This includes fluctuations, which are most readily expressed in terms of chemical potentials. The Helmholtz free energy density is convenient when writing quantities as functions of the charge density $\rho$ and the temperature $T$. In terms of the canonical partition function,
\begin{align*}\eqnumber
f(\rho,T)&=\frac{1}{V}(E-TS)=-\frac{T}{V}\ln Z.
\end{align*}

The differential free energy density is, after using the identity $dV/V=-d\rho/\rho$,
\begin{align*}\eqnumber
df&=\frac{d\rho}{\rho}f+\frac{1}{V}(-SdT-PdV)\\
&=\frac{d\rho}{\rho}f-sdT+\frac{Pd\rho}{\rho}\\
&=\mu d\rho-sdT.
\end{align*}

The last relation used the identity,
\begin{align*}\eqnumber\label{eq:sept}
s=\beta\epsilon+P/T-\mu\rho/T.
\end{align*}
Reading off the last expression,
\begin{align*}\eqnumber
s&=-\frac{\partial f}{\partial T},~~~\mu=\frac{\partial f}{\partial\rho},
\end{align*}
where $f$ is assumed to be a function of $\rho$ and $T$. Using the definition of $f$,
\begin{align*}\eqnumber
\epsilon&=f+Ts=f+T\frac{\partial f}{\partial T}=-T^2\frac{\partial}{\partial T}\left(\frac{f}{T}\right).
\end{align*}
Using Eq. (\ref{eq:sept}) one can write the pressure,
\begin{align*}\eqnumber
P&=-f+\mu\rho.
\end{align*}
Summarizing, to this point we have the basic thermodynamic quantities in terms of $f(T,\rho)$:
\begin{align*}\eqnumber
\epsilon&=-T^2\frac{\partial}{\partial T}\left(\frac{f}{T}\right),\\
s&=-\frac{\partial f}{\partial T},\\
\mu&=\frac{\partial f}{\partial \rho},\\
P&=-f+\mu\rho.
\end{align*}

\subsection{Susceptibilities and fluctuations}

Next, we need to express the susceptibilities. Here, we define $\tilde{\mu}_a=\mu_a/T$. Consider two matrices,
\begin{align*}\eqnumber
\chi_{ab}&\equiv\frac{\partial\rho_a}{\partial\tilde{\mu}_b},\\
M_{ab}&\equiv\frac{\partial\tilde{\mu}_a}{\partial\rho_b}.
\end{align*}
For the first relation, the derivatives assume the other chemical potentials are held constant (while changing $\mu_b$), whereas the second relation implies that the other densities are held constant. One can rewrite these as,
\begin{align*}
\delta\rho_a&=\chi_{ab}\delta\tilde{\mu}_b,\\
\delta\tilde{\mu}_a&=M_{ab}\delta\rho_b.
\end{align*}
If I multiply the lower expression by the inverse of $M$,
\begin{align*}\eqnumber
\delta\rho_a&=M^{-1}_{ab}\delta\tilde{\mu}_b.
\end{align*}
Thus, one can see that
\begin{align*}
M&=\chi^{-1},~~~\chi=M^{-1}.
\end{align*}
Thus, to get the charge fluctuations in the grand-canonical ensemble (which is our goal) from a formulation based on the $f(T,\rho)$, one can proceed via,
\begin{align*}\eqnumber
\tilde{\mu}_a&=\frac{\partial f}{\partial\rho_a},\\
\chi^{-1}_{ab}&=\frac{\partial^2 f}{\partial\rho_a\partial\rho_b}.
\end{align*}
The charge fluctuation is then found by inverting $\chi^{-1}$.

\subsection{The Specific Heat, $\chi_{EE}$, and $\chi_{EQ}$}

One can also find the fluctuation of the energy density, at fixed $\mu$, in terms of $f(T,\rho)$.

\begin{align*}\eqnumber
\delta\epsilon&=
\frac{\partial\epsilon}{\partial\rho_a}\delta\rho_a
+\frac{\partial\epsilon}{\partial T}\delta T,\\
\delta\mu_a&=\frac{\partial\mu_a}{\partial\rho_b}\delta\rho_b+\frac{\partial\mu_a}{\partial T}\delta T=0,\\
\delta\rho_a&=-\left(\frac{\partial\mu}{\partial\rho}\right)_{ab}^{-1}\frac{\partial\mu_b}{\partial T}\delta T,\\
&=-\chi_{ab}\frac{\partial\mu_b}{\partial T}\delta T,\\
\delta\epsilon&=\delta T\left\{
-\frac{\partial \epsilon}{\partial\rho_a}\chi_{ab}\frac{\partial\mu_b}{\partial T}+\frac{\partial\epsilon}{\partial T}
\right\}.
\end{align*}
This yields
\begin{align*}\eqnumber\label{eq:chiEE}
\chi_{EE}&=\frac{\partial\epsilon}{\partial T}
-\frac{\partial\epsilon}{\partial\rho_a}\chi_{ab}\frac{\partial\mu_b}{\partial T}.
\end{align*}

Next, let's calculate $\chi_{EQ}$. We do similar steps above, except set $\delta T=0$.
\begin{align*}
\delta\epsilon&=\frac{\partial\epsilon}{\partial\rho_a}\delta\rho_a,\\
\delta\rho_a&=\chi_{ab}\delta\mu_b,\\
\delta\mu_a&=\chi^{-1}_{ab}\delta\rho_b,\\
\eqnumber\label{eq:chiEQ}
\chi_{EQ}&=\frac{\partial\epsilon}{\partial\mu_a}=\frac{\partial\epsilon}{\partial\rho_b}\chi_{ba}.
\end{align*}

\subsection{Adding Interaction Free Energy to Free-Particle Free Energy}

For our aims, we need to have thermodynamic quantities as a function of density, not chemical potential. Going from one to the other is not particularly difficult, unless one has an unstable mixed-phase region. If one wishes to model the dynamics of such a phase it is imperative to work with quantities which are functions of density. Further, the interaction energy is more straight-forward to describe as an addition to the free-energy density, because it is more often more easily understood as a function of density. For that reason one might think it reasonable to express the free-energy density as
\begin{align*}\eqnumber
f(\rho,T)&=f_{\rm free}(\vec{\rho},T)+f_{\rm int}(\vec{\rho},T).
\end{align*}
In fact, if the interaction is purely density dependent, i.e. independent of the momenta of the underlying particles, then $f_{\rm int}(\rho,T)$ is simply the potential energy density, and is independent of temperature.

Given the definition in Eq. (\ref{eq:f12}), one can immediately see that
\begin{align*}
\mu_{\rm tot}(\vec{\rho},T)&=\mu_{\rm free}(\vec{\rho},T)+\mu_{\rm int}(\vec{\rho},T),\\
P_{\rm tot}(\vec{\rho},T)&=P_{\rm free}(\vec{\rho},T)+P_{\rm int}(\vec{\rho},T),\\
\epsilon_{\rm tot}(\vec{\rho},T)&=\epsilon_{\rm free}(\vec{\rho},T)+\epsilon_{\rm int}(\vec{\rho},T).
\end{align*}
Note that this definition of $P_{\rm int}$ differs from one where the total pressure is defined by separating out the two contributions at the same chemical potential. The latter choice would be natural if one were working in the grand canonical ensemble, in terms of $\vec{\mu}$, rather than in terms of the density.

Thus, give the choice of Eq. (\ref{eq:f12}) one can see that
\begin{align*}
\frac{\partial^2f_{\rm tot}}{\partial\rho_a\partial\rho_b}&=
\frac{\partial^2f_{\rm free}}{\partial\rho_a\partial\rho_b}+\frac{\partial^2f_{\rm int}}{\partial\rho_a\partial\rho_b},\\
\chi^{-1}_{\rm tot}&=\chi^{-1}_{\rm free}+\chi^{-1}_{\rm int}.
\end{align*}
This if one wants the charge susceptibility of the entire system, one should calculate $\chi^{-1}$ for both pieces, add them together, then take the inverse of the matrix.


\subsection{The speed of sound}
When taking partial derivatives, assume functions are of $T$ and $\tilde{\mu}_a\equiv\mu_a/T$.
\begin{align*}\eqnumber
c_s^2&=\left.\frac{\partial P}{\partial\epsilon}\right|_{s/\rho},\\
\delta P&=\frac{\partial P}{\partial T}\delta T+\frac{\partial P}{\partial\tilde{\mu}_a}\delta\tilde{\mu}_a,\\
\delta \epsilon&=\frac{\partial\epsilon}{\partial T}\delta T+\frac{\partial\epsilon}{\partial\tilde{\mu}_a}\delta\tilde{\mu}_a,\\
\delta\rho_a&=\frac{\partial \rho_a}{\partial T}\delta T+\frac{\partial \rho_a}{\partial\tilde{\mu}_b}\delta\tilde{\mu}_b\\
&=\frac{\partial \rho_a}{\partial T}\delta T+\chi_{ab}\delta\tilde{\mu}_b,\\
\delta s&=\frac{\partial s}{\partial T}\delta T+\frac{\partial s}{\partial\tilde{\mu}_a}\delta\tilde{\mu}_a,\\
s^2\delta\left(\frac{\rho_a}{s}\right)&=s\delta\rho_a-\rho_a\delta s=0,\\
0&=s\frac{\partial\rho_a}{\partial T}\delta T+s\chi_{ab}\delta\tilde{\mu}_b
-\rho_b\frac{\partial s}{\partial T}\delta T-\rho_a\frac{\partial s}{\partial\tilde{\mu}_b}\delta\tilde{\mu}_b,\\
\delta\tilde{\mu}_a&=M_a\frac{\delta T}{T},\\
M_a&=T\left(s\chi-\rho\frac{\partial s}{\partial\tilde{\mu}}\right)_{ab}^{-1}
\left(\rho_b\frac{\partial s}{\partial T}-s\frac{\partial\rho_b}{\partial T}\right).
\end{align*}
By substituting for $\delta\tilde{\mu}$ in the expressions for $\delta P$ and $\delta\epsilon$, then taking the ratio $\delta P/\delta\epsilon$, the factors of $\delta T$ drop out and
\begin{align*}\eqnumber
c_s^2&=\frac{1}{T}\frac{P+\epsilon+\rho_aM_a}{\frac{\partial\epsilon}{\partial T}+\frac{\partial\epsilon_a}{\partial\tilde{\mu}_a}M_a}
\end{align*}
Next, substitute for derivative of $s$, so that all derivatives are related to fluctuations.
\begin{align*}
\frac{\partial P}{\partial T}&=\frac{P+\epsilon}{T},\\
\frac{\partial s}{\partial T}&=\frac{\partial}{\partial T}\left(\frac{P+\epsilon-\tilde\mu_a\rho_aT}{T}\right)\\
&=\frac{1}{T}\left(\frac{P+\epsilon}{T}+\frac{\partial\epsilon}{\partial T}-T\tilde{\mu_a}\frac{\partial\rho_a}{\partial T}-\tilde{\mu}_a\rho_a\right)-\frac{s}{T}\\
&=\frac{1}{T}\frac{\partial\epsilon}{\partial T}-\tilde{\mu}_a\frac{\partial\rho_a}{\partial T},\\
\frac{\partial s}{\partial\tilde{\mu}_a}&=\frac{1}{T}\frac{\partial}{\partial\tilde{\mu}_a}(P+\epsilon-\tilde{\mu}_b\rho_bT),\\
&=\frac{1}{T}\left(
\rho_aT+\frac{\partial\epsilon}{\partial\tilde{\mu}_a}-\rho_aT-\tilde{\mu_b}T\frac{\partial\tilde{\mu}_b}{\partial\mu_a}
\right)\\
&=\frac{1}{T}\left(
\frac{\partial\epsilon}{\partial\tilde{\mu}_a}-\tilde{\mu}_bT\frac{\partial\rho_b}{\partial\tilde{\mu}_a}
\right)m\\
M_a&=A^{-1}_{ab}\left(
\rho_b \frac{\partial\epsilon}{\partial T} XX -\rho_bT\tilde{\mu}_c\frac{\partial\rho_c}{\partial T} XX-Ts\frac{\partial\rho_b}{\partial T}\right),\\
A_{ab}&=s\chi_{ab}-\rho_a\left(
\frac{1}{T}\frac{\partial\epsilon}{\partial\tilde{\mu}_b}-\tilde{\mu}_c\frac{\partial\rho_c}{\partial\tilde{\mu}_b}
\right)\\
&=s\chi_{ab}-\frac{\rho_a}{T}\frac{\partial\epsilon}{\partial\tilde{\mu}_b}+\rho_a\chi_{bc}\tilde{\mu}_c.
\end{align*}
Now, let's summarize the results for the speed of sound using the following definitions for the generalized susceptibilities,
\begin{align*}\eqnumber
\xi&\equiv \frac{\partial\epsilon}{\partial T}=\frac{1}{T^2V}\langle\delta E\delta E\rangle,\\
\zeta_a&\equiv\frac{1}{T}\frac{\partial\epsilon}{\partial\tilde{\mu}_a}=T\frac{\partial\rho_a}{\partial T}
=\frac{1}{TV}\langle\delta E\delta Q_a\rangle,\\
\chi_{ab}&\equiv\frac{\partial\rho_a}{\partial\tilde{\mu}_b}=\frac{1}{V}\langle\delta Q_a\delta Q_b\rangle.
\end{align*}
This gives
\begin{align*}\eqnumber\label{eq:f12}
c_s^2&=\frac{(P+\epsilon)/T+\rho_a M_a}{\xi+\zeta_aM_a},\\
M_a&=A^{-1}_{ab}[(\xi-\tilde{\mu}_c\zeta_c)\rho_b-s\zeta_b],\\
A_{ab}&=s\chi_{ab}-\rho_a\zeta_b.
\end{align*}

\subsection{How our code works}

The code has simple routines that calculate the free-particle contributions to $\vec{\rho},P,\epsilon$ and $\chi$ in terms of $\vec{\mu}$ and $T$. An optimized Newton's method routine is used to find $\vec{\mu}$ in terms of $\vec{\rho}$ and $T$. This results in an easily accessible routine that gives all the thermodyanmic quantities in terms of $\vec{\rho}$ and $T$. One can invert $\chi$ to find the free-energy contribution to $\chi^{-1}$. This thus provides $P_{\rm free}$, $\epsilon_{\rm free}, \vec{\mu}_{\rm free}$ and $\chi^{-1}_{\rm free}$.

Next, one calls a function that provides the free energy, plus all its derivatives with respect to $\vec{\rho}$. This provides the interaction contributions, $f_{\rm int}, P_{\rm int}$, $\epsilon_{\rm int}, \vec{\mu}_{\rm int}$ and $\chi^{-1}_{\rm int}$. If one has an analytic form for $f_{\rm int}(\vec{\rho},T)$ it is usually simple to find all the interaction contributions by taking derivatives.

Finally, one finds the thermodynamic quantities of the entire system by simply adding the two pieces. This gives $f_{\rm tot}, P_{\rm tot}$, $\epsilon_{\rm tot}, \vec{\mu}_{\rm tot}$ and $\chi^{-1}_{\rm tot}$. The susceptibility is then found by taking the inverse of the sums of $\chi^{-1}_{\rm free}$ and $\chi^{-1}_{\rm int}$,
\begin{align*}\eqnumber
\chi_{\rm tot}&=\left[\chi^{-1}_{\rm free}+\chi^{-1}_{\rm int}\right]^{-1}.
\end{align*}

Once you have these quantities, you can find $\chi_{EE}$ and $\chi_{EQ}$ using Eq.s (\ref{eq:chiEE}) and (\ref{eq:chiEQ}).

\end{document}